<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>兼职招聘平台管理系统--添加管理员</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
        <meta name="apple-mobile-web-app-status-bar-style" content="black"> 
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="format-detection" content="telephone=no">
        
        <link rel="stylesheet" href="../../../layui/css/layui.css" media="all">
        <link rel="stylesheet" href="../../../layui/css/global.css" media="all">
        <link rel="stylesheet" href="../../../layui/css/modules/layer/default/layer.css" media="all">
        
        <script type="text/javascript" src="../js/jquery-3.3.1.js"></script>
        <script src="../js/general.js" charset="utf-8"></script>
        <script type="text/javascript" src="js/add_admin.js"></script>
        <style>
            .bg-color-menu {
                background-color: #20222A !important;
            }
        </style>
    </head>
    <body>
        <div class="layui-layout layui-layout-admin">
            <!-- 顶部导航栏 -->
            <div class="layui-header header header-demo">
                <div class="layui-main">
                    <a class="" href="../main.html" style="height: 100%; font-size: 20px;color: rgba(255, 255, 255, 0.8); line-height: 57px; font-weight: 500">
                        兼职招聘平台管理系统
                    </a>
                    <div class="layui-form component" lay-filter="LAY-site-header-component"></div>
                    <ul class="layui-nav">
                        <li class="layui-nav-item ">
                            <a href="../../../post/home.html">返回前台</a>
                        </li>
                        <li class="layui-nav-item">
                            <a href="javascript:;">
                                <img src="../images/user_default.jpg" class="layui-nav-img">
                                我
                                <span class="layui-nav-more"></span>
                            </a>
                            <dl class="layui-nav-child layui-anim layui-anim-upbit" id="list_cur" style="top: 60px;">
                                <dd style="border: 0px; height: 5px;"></dd>
                                <dd><a onclick="updatePwd()" style="cursor:pointer;">修改密码</a></dd>
                                <dd><a onclick="openUpdate()" style="cursor:pointer;">修改信息</a></dd>
                                <dd><a onclick="signOut()" style="cursor:pointer;">退出</a></dd>
                            </dl>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- 左侧垂直导航栏 -->
            <div class="layui-side layui-bg-black">
                <div class="layui-side-scroll bg-color-menu">
                    <ul class="layui-nav layui-nav-tree">
                        <li class="layui-nav-item bg-color-menu">
                            <a href="javascript:;"><i class="layui-icon layui-icon-home" style="font-size:16px;"></i>&nbsp;&nbsp;平台管理</a>
                            <dl class="layui-nav-child">
                                <dd class="">
                                    <a href="../main.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主页</a>
                                </dd>
                                <dd class="">
                                    <a href="../platform/data_statistics.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;数据统计</a>
                                </dd>
                                <dd class="">
                                    <a href="../platform/announcement.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;公告管理</a>
                                </dd>
                            </dl>
                        </li>
                        <li class="layui-nav-item bg-color-menu">
                            <a href="javascript:;"><i class="layui-icon layui-icon-flag" style="font-size:16px;"></i>&nbsp;&nbsp;岗位管理</a>
                            <dl class="layui-nav-child">
                                <dd class="">
                                    <a href="../post/add_post.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;岗位发布</a>
                                </dd>
                                <dd class="">
                                    <a href="../post/post_list.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;岗位列表</a>
                                </dd>
                                <dd class="">
                                    <a href="../post/post_type.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;岗位分类</a>
                                </dd>
                            </dl>
                        </li>
                        <li class="layui-nav-item bg-color-menu">
                            <a href="javascript:;"><i class="layui-icon layui-icon-user" style="font-size:16px;"></i>&nbsp;&nbsp;用户管理</a>
                            <dl class="layui-nav-child">
                                <dd class="">
                                    <a href="../user/add_employer.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;添加招聘方</a>
                                </dd>
                                <dd class="">
                                    <a href="../user/employer_list.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;招聘方列表</a>
                                </dd>
                                <dd class="">
                                    <a href="../user/user_list.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;用户列表</a>
                                </dd>
                                </dd>
                            </dl>
                        </li>
                        <li class="layui-nav-item bg-color-menu layui-nav-itemed">
                            <a href="javascript:;"><i class="layui-icon layui-icon-set" style="font-size:16px;"></i>&nbsp;&nbsp;管理员管理</a>
                            <dl class="layui-nav-child">
                                <dd class="layui-this">
                                    <a href="#">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;添加管理员</a>
                                </dd>
                                <dd class="">
                                    <a href="admin_list.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;管理员列表</a>
                                </dd>
                            </dl>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- 主体内容 -->
            <div class="layui-body" id="LAY_app_body">
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend>添加管理员</legend>
                </fieldset>
                <form class="layui-form" action="" style="margin:50px 0 0 30%; font-size:15px">
                    <div class="layui-form-item layui-upload">
                        <label class="layui-form-label">照&nbsp;&nbsp;&nbsp;片</label>
                        <div class="layui-upload-list">
                            <img class="layui-upload-img" id="demo1" style="float:left;">
                            <div style="float:left;">
                                <button type="button" class="layui-btn" id="upload">上传图片</button>
                                <p id="demoText" style="width: 100px; margin-top: 20px"></p>
                            </div>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">用户名</label>
                        <div class="layui-input-block">
                        <input type="text" id="username" autocomplete="off" placeholder="3-20 characters unique" required class="layui-input" style="width: 250px;" onchange="inputLimit()" onkeydown="inputLimit()" onkeyup="inputLimit()">
                        </div>
                    </div>
                    <div class="layui-form-item">
                    <label class="layui-form-label">密&nbsp;&nbsp;&nbsp;码</label>
                        <div class="layui-input-block">
                            <input type="password" id="password" placeholder="5-20 characters" autocomplete="off" required lay-verify="password" class="layui-input" style="width: 250px;" onchange="inputLimit()" onkeydown="inputLimit()" onkeyup="inputLimit()">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">确认密码</label>
                        <div class="layui-input-block">
                            <input type="password" id="confirmPwd" placeholder="请确认密码" autocomplete="off" required lay-verify="password" class="layui-input" style="width: 250px;" onchange="inputLimit()" onkeydown="inputLimit()" onkeyup="inputLimit()" onblur="passwordLimit()">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">性&nbsp;&nbsp;&nbsp;别</label>
                        <div class="layui-input-block">
                            <input name="sex" title="男" type="radio" checked="" value="男">
                            <div class="layui-unselect layui-form-radio layui-form-radioed">
                                <i class="layui-anim layui-icon"></i>
                                <div>男</div>
                            </div>
                            <input name="sex" title="女" type="radio" value="女">
                            <div class="layui-unselect layui-form-radio">
                                <i class="layui-anim layui-icon"></i>
                                <div>女</div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">姓&nbsp;&nbsp;&nbsp;名</label>
                        <div class="layui-input-block">
                            <input type="text" id="realname" autocomplete="off" required placeholder="3-20 characters" class="layui-input" style="width: 250px;" onchange="inputLimit()" onkeydown="inputLimit()" onkeyup="inputLimit()">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">邮&nbsp;&nbsp;&nbsp;箱</label>
                        <div class="layui-input-block">
                            <input type="text" id="email" autocomplete="off" lay-verify="email" placeholder="请输入邮箱" class="layui-input" style="width: 250px;" onchange="inputLimit()" onkeydown="inputLimit()" onkeyup="inputLimit()">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">手机号</label>
                        <div class="layui-input-block">
                            <input type="text" id="phone" autocomplete="off" required lay-verify="phone" placeholder="请输入手机号" class="layui-input" style="width: 250px;" onchange="inputLimit()" onkeydown="inputLimit()" onkeyup="inputLimit()">
                        </div>
                    </div>
    
                    <div class="layui-form-item" style="margin-top:30px">
                    <div class="layui-input-block">
                        <button type="button" class="layui-btn" onclick="add_admin()">立即提交</button>
                        <button type="reset" class="layui-btn layui-btn-primary" onclick="
                        $('#demo1').attr('src', '');
                        ">重置</button>
                    </div>
                    </div>
                </form>
            </div>
        </div>
        <!-- 引入或者加载脚本 -->
        <script src="../../../layui/layui.all.js" charset="utf-8"></script>
        <div id="LAY_democodejs">
            <script>
                layui.use('form', function(){
                    var form = layui.form;
                    form.render();
                    form.verify();
                });
                function passwordLimit(){
                    var input = window.event.target;
                    input.value = input.value.substring(0,20); if(window.event.keyCode == 13) return false;
                    var pwd = document.getElementById("password");
                    if(pwd.value.toString() != input.value.toString()){
                        layer.tips("两次密码不相同！", "#confirmPwd");
                    }
                }

                var photo, username, password, confirmPwd, gender, realname, email, telephone, admin_type;
                var uploadInst;
                function add_admin(){
                    username = document.getElementById('username').value;
                    password = document.getElementById('password').value;
                    confirmPwd = document.getElementById('confirmPwd').value;
                    gender = ((document.getElementsByClassName('layui-form-radioed'))[0]).childNodes[1].innerText;
                    realname = document.getElementById('realname').value;
                    email = document.getElementById('email').value;
                    telephone = document.getElementById('phone').value;
                    var reg1 = new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$");
                    var reg2 = new RegExp("^[1][3,4,5,7,8][0-9]{9}$");
                    var reg3 = new RegExp("[\u4e00-\u9fa5]");

                    if(username == "" || username == null){
                        layer.tips("用户名不能为空！", "#username");
                    }
                    else if(username.length < 3 || username.length > 20){
                        layer.tips("3-20 characters", "#username");
                    }
                    else if(reg3.test(username)){
                        layer.tips("不能包含中文", "#username");
                    }
                    else if(password == null || password == ""){
                        layer.tips("密码不能为空！", "#password");
                    }
                    else if(reg3.test(password)){
                        layer.tips("密码不能包含中文", "#password");
                    }
                    else if(password.length < 5 || password.length > 20){
                        layer.tips("5-20 characters", "#password");
                    }
                    else if(confirmPwd == null || confirmPwd == ""){
                        layer.tips("请再次输入密码！", "#confirmPwd");
                    }
                    else if(password != confirmPwd){
                        layer.tips("两次密码不相同！", "#confirmPwd");
                    }
                    else if(gender == "" || gender == null){
                        layer.msg("请选择性别！");
                    }
                    else if(realname == "" || realname == null){
                        layer.tips("姓名不能为空！", "#realname");
                    }
                    else if(email != null && email != "" && !reg1.test(email)){
                        layer.tips("请注意邮箱格式！", "#email");
                    }
                    else if(telephone == "" || telephone == null){
                        layer.tips("手机号不能为空！", "#phone");
                    }
                    else if(!reg2.test(telephone)){
                        layer.tips("请注意手机号格式！", "#phone");
                    }
                    else if(photo != null) {
                        uploadInst.upload();
                    }
                    else {
                        add_Admin(photo, username, password, gender, realname, email, telephone);
                    }
                }
                layui.use('upload', function() {
                    var $ = layui.jquery, upload = layui.upload;
                    //普通图片上传使用layui上传图片
                    uploadInst = upload.render({
                        elem: '#upload'
                        , url: '../../../upload/uploadImg'
                        , accept : 'images'
                        , multiple : false
                        , auto : false
                        , field : 'file'
                        , choose: function (obj) { +
                            //预读本地文件示例，不支持ie8 +
                            obj.preview(function (index, file, result) {
                                $('.layui-upload').css("height", "10%");
                                $('.layui-upload').css("marginButtom", "10px");
                                $('#demo1').attr('src', result); //图片链接（base64）
                                $('#demo1').css("maxWidth", "10%");
                                $('#demo1').css("marginRight", "10px");
                                photo = result;
                            });
                        }
                        , done: function (res) {
                            //如果上传失败
                            if (res.code > 0) {
                                return layer.msg('上传失败');
                            }
                            //上传成功
                            else
                            {
                                photo = res.photoAddr;
                                $('#demo1').attr('src', photo);
                                add_Admin(photo, username, password, gender, realname, email, telephone);
                            }
                        }
                        , error: function () {
                            //演示失败状态，并实现重传
                            var demoText = $('#demoText');
                            demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
                            demoText.find('.demo-reload').on('click', function () {
                                uploadInst.upload();
                            });
                    }
                    });
                });
                function add_Admin(photo, username, password, gender, realname, email, telephone){
                    //请求添加管理员用户的接口
                    $.ajax({
                        url : '../../../admin/saveAdmin',
                        data : {"adminUsername":username,"adminPassword":password,"adminTel":telephone,
                            "adminName":realname, "adminGender":gender, "adminEmail":email,"adminPhoto" : photo},
                        type : 'post',
                        scriptCharset : 'utf-8',
                        success : function (result) {
                            if(result.message == null) {
                                layer.open({
                                    type: 1,
                                    offset: 'auto',
                                    id: 'layerDemo1', //防止重复弹出
                                    content: '<div style="padding: 20px 100px;">' + "添加成功！" + '</div>',
                                    btn: '关闭',
                                    btnAlign: 'c', //按钮居中
                                    shade: 0.5, //不显示遮
                                    title: "HZNUPOST",
                                    yes: function () {
                                        layer.closeAll();
                                    }
                                });
                                $('.layui-btn-primary').click();
                                $('#demo1').attr('src', '');
                            }
                            else{
                                layer.open({
                                    type: 1,
                                    offset: 'auto',
                                    id: 'layerDemo1', //防止重复弹出
                                    content: '<div style="padding: 20px 100px;">' + result.message + '</div>',
                                    btn: '关闭',
                                    btnAlign: 'c', //按钮居中
                                    shade: 0.5, //不显示遮罩
                                    title: "HZNUPOST",
                                    yes: function () {
                                        layer.closeAll();
                                    }
                                });
                            }

                        },
                        error : function () {
                            layer.msg("请求添加管理员失败！")
                        }
                    });
                }
            </script>
            <script>
                layui.use('element', function(){
                    var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块
                    //监听导航点击
                    element.on('nav(demo)', function(elem){
                        //console.log(elem)
                        layer.msg(elem.text());
                    });
                });
            </script>
        </div>
    </body>
</html>